---
sidebar_position: 4
---

# 运行机制

极态运行机制由JitNode实现，应用加载和元素加载是懒加载，首次访问时触发加载。涉及到的运行时流程主要有：请求处理流程、应用实例化流程、元素查找流程、加载器获取流程。

## 请求处理流程

### 运行环境路由

JIT内核接收浏览器或其他终端的请求后，通过以下参数匹配目标环境：

1.  域名/端口组合
    
2.  请求头中`envId`（优先级高于域名）
    
3.  将请求定向至对应节点实例的运行环境对象
    

### 应用路由

1.  解析请求中的`OrgId.AppId`组合标识
    
2.  进程级应用容器中检索目标应用对象：
    
    1.  存在 → 移交请求至应用对象
        
    2.  缺失 → 触发应用实例化流程
        

### 元素路由

应用对象解析请求路径，执行：

1.  从请求路径中提取出元素`fullname`和目标函数
    
2.  基于元素查找流程获取元素对象
    
3.  调用元素对象的目标函数
    

### 响应封装

内核将执行结果标准化为统一响应结构：

1.  状态码（成功/错误类型）
    
2.  业务数据体
    
3.  错误信息
    
4.  调试信息（RequestId、请求耗时等）
    

## 应用实例化流程

### 应用目录校验

1.  检查运行环境目录是否存在`OrgId/AppId/Version`应用文件夹
    
2.  目录缺失时：
    
    1.  向JCS（Jit Center Service）服务器申请临时访问令牌
        
    2.  下载应用资源包至运行环境目录
        

### 构建状态判断

1.  预构建模式：存在`dist/app.jit`及元素的构建产物目录 → 直接加载
    
2.  源码模式：存在完整`app.json`及源码 → 触发JitBuilder编译
    
3.  异常模式：无有效构建产物及源码 → 会抛出异常，需要应用开发人员介入
    

## 元素查找流程

### 运行时元素容器查询

当前应用元素容器中检索`fullname`对应的对象。

### 根据app.jit加载

检查`app.jit`中的`elements`列表，匹配fullname，匹配则：

1.  实例化元素对象
    
2.  执行加载器获取流程，获取加载器
    
3.  加载元素实体对象
    

### 继承链追溯

app.jit中未匹配到fullname时，沿继承链（父应用→祖应用）递归执行查找。

## 加载器获取流程

1.  元素`type`指向的Type元素定义了`loader` → 直接启用该加载器
    
2.  Type元素未定义加载器 → 使用其Type元素的加载器（递归向上追溯）
    
3.  没有type值，则使用内核默认的加载器